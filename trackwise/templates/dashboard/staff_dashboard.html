{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard/staff_dashboard.css' %}">
{% endblock %}

{% block title %}Dashboard - TrackWise{% endblock %}

{% block content %}
<!-- Navigation -->
<nav class="navbar">
    <div class="navbar-content">
        <!-- Logo on the left -->
        <a href="{% url 'dashboard:dashboard' %}" class="navbar-brand">
            <i class="fas fa-chart-line"></i>
            TrackWise
        </a>

        <!-- Navigation in center -->
        <div class="navbar-menu">
            <a href="{% url 'dashboard:dashboard' %}" class="nav-link active"><i class="fas fa-home"></i> Dashboard</a>
            <a href="{% url 'inventory:inventory_list' %}" class="nav-link"><i class="fas fa-boxes"></i> Inventory</a>
            <a href="#" class="nav-link"><i class="fas fa-history"></i> Activity Log</a>
        </div>

        <!-- Profile with dropdown on the right -->
        <div class="user-section">
            <div class="user-info" id="userDropdownTrigger">
                <span>{{ profile.user.first_name }} {{ profile.user.last_name }}</span>
                <div class="user-avatar">{{ profile.user.first_name|first }}{{ profile.user.last_name|first }}</div>
                <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
            </div>
            
            <div class="user-dropdown" id="userDropdown">
                <div class="user-dropdown-item">
                    <i class="fas fa-user"></i>
                    <span>Profile Settings</span>
                </div>
                <div class="user-dropdown-item">
                    <i class="fas fa-cog"></i>
                    <span>Account Settings</span>
                </div>
                <div class="user-dropdown-divider"></div>
                <form method="post" action="{% url 'accounts:logout' %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="user-dropdown-item">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</nav>

<!-- Dashboard Content -->
<div class="dashboard-wrapper">
    <div class="container">
        <div class="dashboard-header">
            <h1 class="welcome-text">Welcome, {{ profile.user.first_name }}!</h1>
            <p class="subtitle">Here's your overview for {{ profile.company.name }}</p>
        </div>

        <div class="row">
            <!-- Left Column -->
            <div class="left-column">
                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">{{ total_products }}</div>
                        <div class="stat-label">Total Products</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ low_stock }}</div>
                        <div class="stat-label">Low Stock Items</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ out_of_stock }}</div>
                        <div class="stat-label">Out of Stock</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ recent_updates }}</div>
                        <div class="stat-label">Today's Updates</div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="activity-feed">
                    <h4><i class="fas fa-history"></i> Recent Activity</h4>
                    
                    {% if recent_activity %}
                        {% for product in recent_activity %}
                        <div class="activity-item">
                            <div class="activity-icon">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="activity-content">
                                <strong>{{ product.item_name }}</strong> was updated
                                <div class="activity-time">{{ product.updated_at|timesince }} ago</div>
                            </div>
                            <div class="activity-status">
                                <span class="badge {% if product.quantity == 0 %}bg-danger{% elif product.quantity <= 10 %}bg-warning{% else %}bg-success{% endif %}">
                                    {{ product.quantity }} in stock
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">No recent activity</p>
                    {% endif %}
                </div>
            </div>

            <!-- Right Column -->
            <div class="right-column">
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h5><i class="fas fa-bolt"></i> Quick Actions</h5>
                    <a href="{% url 'inventory:product_add' %}" class="action-btn">
                        <i class="fas fa-plus"></i> Add New Product
                    </a>
                    <a href="{% url 'inventory:inventory_list' %}" class="action-btn">
                        <i class="fas fa-boxes"></i> View Inventory
                    </a>
                    <a href="#" class="action-btn">
                        <i class="fas fa-sync"></i> Update Stock
                    </a>
                </div>

                <!-- Recent Products -->
                <div class="recent-products">
                    <h5><i class="fas fa-clock"></i> Recent Products</h5>
                    
                    {% if recent_products %}
                        {% for product in recent_products %}
                        <div class="product-item">
                            {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.item_name }}" class="product-image">
                            {% else %}
                            <div class="product-image">
                                <i class="fas fa-box"></i>
                            </div>
                            {% endif %}
                            <div class="product-info">
                                <strong>{{ product.item_name }}</strong>
                                <div class="small">{{ product.category|title }}</div>
                            </div>
                            <span class="{% if product.quantity == 0 %}stock-out{% elif product.quantity <= 10 %}stock-low{% else %}stock-ok{% endif %}">
                                {{ product.quantity }}
                            </span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">No products available</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const userDropdownTrigger = document.getElementById('userDropdownTrigger');
    const userDropdown = document.getElementById('userDropdown');
    
    // Toggle dropdown on click
    userDropdownTrigger.addEventListener('click', function(e) {
        e.stopPropagation();
        userDropdown.classList.toggle('active');
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
        if (!userDropdown.contains(e.target) && !userDropdownTrigger.contains(e.target)) {
            userDropdown.classList.remove('active');
        }
    });
    
    // Close dropdown when pressing Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            userDropdown.classList.remove('active');
        }
    });
});
</script>
{% endblock %}